#!/bin/sh -e

patch -p1 < u16-fix.patch
patch -p0 < fix-musl.patch
patch -p1 < nogl.patch

mkdir build
cd build

CFLAGS="${CFLAGS} -Wno-expansion-to-defined" \
CXXFLAGS="${CXXFLAGS} -Wno-expansion-to-defined" \
cmake \
	-DCMAKE_BUILD_TYPE=Release \
	-DCMAKE_INSTALL_PREFIX=/usr \
	-DCMAKE_SKIP_RPATH=ON \
	-DPORT=GTK \
	-DLIB_INSTALL_DIR=/usr/lib \
	-DUSE_LIBHYPHEN=OFF \
	-DENABLE_MINIBROWSER=OFF \
	-DUSE_WOFF2=OFF \
	-DUSE_WPE_RENDERER=OFF \
	-DENABLE_INTROSPECTION=OFF \
	-DENABLE_INTL=OFF \
	-DUSE_LIBSECRET=OFF \
	-DUSE_OPENJPEG=OFF \
	-DENABLE_BUBBLEWRAP_SANDBOX=OFF \
	-DENABLE_GEOLOCATION=OFF \
	-DENABLE_SPELLCHECK=OFF \
	-DENABLE_GLES2=ON \
	-DENABLE_VIDEO=OFF \
	-DENABLE_OPENGL=OFF \
	-DENABLE_WEBGL=OFF \
	-DENABLE_WEB_AUDIO=OFF \
	-DUSE_LIBNOTIFY=OFF \
	-Wno-dev -G Ninja ..

ninja
DESTDIR="$1" ninja install
