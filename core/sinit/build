#!/bin/sh -e

(
    cd sinit
    make CFLAGS="$CFLAGS -static" PREFIX=/usr DESTDIR="$1" install
)
ln -s sinit "$1/usr/bin/init"

install -Dm755 poweroff "$1/usr/bin/poweroff"
install -Dm755 reboot "$1/usr/bin/reboot"

install -Dm644 sinit-launch-services.boot "$1/etc/init/sinit-launch-services.boot"

# shellcheck disable=2086
"${CC:-gcc}" -o "$1/usr/bin/kpow" init/bin/kpow.c $CFLAGS -static
